<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Spark Ad Studio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #050816;
      --bg-alt: #0b1020;
      --card: #111827;
      --accent: #ff7a3c;
      --accent-soft: #ffd2aa;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.35);
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #050816 55%, #020617 100%);
      color: var(--text);
      min-height: 100vh;
    }

    body.light {
      --bg: #f3f4f6;
      --bg-alt: #e5e7eb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border-subtle: rgba(148, 163, 184, 0.5);
      background: linear-gradient(to bottom, #e5e7eb, #f9fafb);
    }

    a { color: inherit; text-decoration: none; }

    .container {
      width: min(1100px, 92vw);
      margin: 0 auto;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(18px);
      background: linear-gradient(to bottom, rgba(5, 8, 22, 0.95), transparent);
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
    }

    body.light header {
      background: linear-gradient(to bottom, rgba(243, 244, 246, 0.95), transparent);
      border-bottom-color: rgba(209, 213, 219, 0.9);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      gap: 16px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-logo {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0, #f97316, #7c2d12);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
      color: #111827;
    }

    body.light .nav-logo {
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.25);
      color: #111827;
    }

    .nav-titles {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .nav-title {
      font-weight: 700;
      letter-spacing: 0.03em;
      font-size: 18px;
    }

    .nav-sub {
      font-size: 11px;
      text-transform: uppercase;
      color: var(--muted);
      letter-spacing: 0.12em;
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .nav-links {
      display: flex;
      gap: 10px;
      font-size: 13px;
      color: var(--muted);
    }

    .nav-link {
      border: none;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 999px;
    }

    .nav-link:hover {
      color: var(--accent);
    }

    .nav-link.active {
      color: var(--accent);
      font-weight: 600;
    }

    .nav-cta {
      border: none;
      cursor: pointer;
      padding: 7px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, #f97316, #fb7185);
      color: #111827;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.6);
    }

    body.light .nav-cta {
      color: #111827;
      box-shadow: 0 12px 25px rgba(15, 23, 42, 0.25);
    }

    main {
      padding-bottom: 40px;
    }

    .screen {
      display: none;
      padding: 32px 0;
    }

    .screen.active {
      display: block;
    }

    /* INFO / HERO */
    .info-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 24px;
      align-items: center;
    }

    @media (max-width: 840px) {
      .info-layout {
        grid-template-columns: 1fr;
      }
    }

    .kicker {
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent-soft);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .k-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
    }

    .hero-title {
      font-size: clamp(30px, 4vw, 36px);
      font-weight: 700;
      margin-bottom: 8px;
    }

    .hero-title span {
      background: linear-gradient(135deg, #f97316, #fb7185, #a855f7);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-lead {
      font-size: 14px;
      color: var(--muted);
      max-width: 520px;
      margin-bottom: 18px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 18px;
      font-size: 11px;
    }

    .pill {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      color: var(--accent-soft);
      background: rgba(15, 23, 42, 0.8);
    }

    body.light .pill {
      background: rgba(255, 255, 255, 0.8);
      color: #7c2d12;
    }

    .primary-btn {
      border: none;
      cursor: pointer;
      padding: 10px 18px;
      border-radius: 999px;
      background: linear-gradient(135deg, #f97316, #fb7185);
      color: #111827;
      font-weight: 600;
      font-size: 13px;
      box-shadow: 0 16px 36px rgba(0, 0, 0, 0.6);
    }

    .card {
      background: radial-gradient(circle at top left, rgba(248, 250, 252, 0.08), transparent 55%),
                  var(--card);
      border-radius: var(--radius-lg);
      padding: 16px 16px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.6);
      font-size: 13px;
    }

    body.light .card {
      box-shadow: 0 12px 26px rgba(15, 23, 42, 0.18);
    }

    .card h3 {
      font-size: 15px;
      margin-bottom: 6px;
    }

    /* AUTH */
    .auth-wrapper {
      max-width: 420px;
      margin: 0 auto;
    }

    .auth-title {
      font-size: 20px;
      text-align: center;
      margin-bottom: 8px;
    }

    .auth-sub {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      margin-bottom: 18px;
    }

    .auth-tabs {
      display: flex;
      background: rgba(15, 23, 42, 0.9);
      padding: 3px;
      border-radius: 999px;
      margin-bottom: 12px;
    }

    body.light .auth-tabs {
      background: rgba(229, 231, 235, 0.9);
    }

    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 6px 0;
      font-size: 13px;
      border-radius: 999px;
      cursor: pointer;
      color: var(--muted);
    }

    .auth-tab.active {
      background: linear-gradient(135deg, #f97316, #fb7185);
      color: #111827;
      font-weight: 600;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    .field label {
      font-size: 12px;
      color: var(--muted);
    }

    .field input,
    .field textarea,
    .field select {
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 8px 10px;
      font-size: 13px;
      background: rgba(15, 23, 42, 0.8);
      color: var(--text);
      outline: none;
    }

    body.light .field input,
    body.light .field textarea,
    body.light .field select {
      background: #f9fafb;
      color: #111827;
      border-color: rgba(148, 163, 184, 0.6);
    }

    .field textarea {
      min-height: 90px;
      resize: vertical;
    }

    .btn-full {
      width: 100%;
      margin-top: 4px;
    }

    .status-text {
      font-size: 12px;
      color: var(--accent-soft);
      min-height: 16px;
      margin-top: 6px;
    }

    /* CONTENT */
    .section-title {
      font-size: 20px;
      margin-bottom: 4px;
    }

    .section-sub {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 16px;
    }

    .notif-list {
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      padding: 10px;
      font-size: 13px;
    }

    body.light .notif-list {
      background: rgba(255, 255, 255, 0.85);
    }

    .notif-item {
      padding: 8px 6px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .notif-item:last-child {
      border-bottom: none;
    }

    .notif-meta {
      font-size: 11px;
      color: var(--accent-soft);
      margin-bottom: 2px;
    }

    .pill-status {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10px;
      margin-left: 6px;
    }

    .s-pending {
      background: rgba(234, 179, 8, 0.15);
      color: #facc15;
    }

    .s-approved {
      background: rgba(22, 163, 74, 0.2);
      color: #4ade80;
    }

    .s-rejected {
      background: rgba(239, 68, 68, 0.18);
      color: #fca5a5;
    }

    .grid-two {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 16px;
    }

    @media (max-width: 840px) {
      .grid-two {
        grid-template-columns: 1fr;
      }
    }

    /* ADMIN */
    .admin-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 16px;
    }

    @media (max-width: 960px) {
      .admin-layout {
        grid-template-columns: 1fr;
      }
    }

    .admin-list {
      max-height: 260px;
      overflow-y: auto;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 8px;
      font-size: 12px;
      background: rgba(15, 23, 42, 0.9);
    }

    body.light .admin-list {
      background: rgba(255, 255, 255, 0.9);
    }

    .admin-item {
      padding: 6px 4px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .admin-item:last-child {
      border-bottom: none;
    }

    .admin-meta {
      font-size: 11px;
      color: var(--accent-soft);
      margin-bottom: 2px;
    }

    .admin-actions {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .admin-actions input {
      flex: 1;
      min-width: 120px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .btn-small {
      border-radius: 999px;
      border: none;
      font-size: 11px;
      padding: 4px 9px;
      cursor: pointer;
    }

    .btn-approve {
      background: rgba(22, 163, 74, 0.9);
      color: #e5f9ed;
    }

    .btn-reject {
      background: rgba(239, 68, 68, 0.9);
      color: #fee2e2;
    }

    footer {
      padding: 18px 0 28px;
      font-size: 12px;
      color: var(--muted);
    }

    footer .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="nav-left">
      <div class="nav-logo">SA</div>
      <div class="nav-titles">
        <div class="nav-title">Spark Ad Studio</div>
        <div class="nav-sub">kul√ºpler & markalar i√ßin mini st√ºdyo</div>
      </div>
    </div>
    <div class="nav-right">
      <div class="nav-links" id="nav-links" style="display:none;">
        <button class="nav-link" data-target="info" id="nav-info">Bilgi</button>
        <button class="nav-link" data-target="main" id="nav-main">Ana Sayfa</button>
        <button class="nav-link" data-target="studio" id="nav-studio">St√ºdyo</button>
        <button class="nav-link" data-target="settings" id="nav-settings">Ayarlar</button>
        <button class="nav-link" data-target="admin" id="nav-admin" style="display:none;">Y√∂netici</button>
      </div>
      <button class="nav-cta" id="btn-auth">√úye Ol / Giri≈ü Yap</button>
    </div>
  </div>
</header>

<main>
  <div class="container">

    <!-- Bƒ∞LGƒ∞ / LANDING -->
    <section class="screen active" id="screen-info">
      <div class="info-layout">
        <div>
          <div class="kicker">
            <span class="k-dot"></span> GEN√á ZEK√ÇLAR ƒ∞√áƒ∞N REKLAM ST√úDYOSU
          </div>
          <h1 class="hero-title">
            <span>Spark Ad Studio</span> ile kul√ºpler ve markalar i√ßin eƒülenceli reklam fikirleri.
          </h1>
          <p class="hero-lead">
            Reklam isteyen kul√ºpler kƒ±sa bir form dolduruyor, sen de onlarƒ±n istediƒüi ≈üeye g√∂re
            akƒ±lda kalƒ±cƒ± dijital i√ßerik fikirleri √ºretiyorsun. Y√∂netici panelinden gelen istekleri
            g√∂r√ºp takip edebiliyorsun.
          </p>
          <div class="pill-row">
            <span class="pill">üéØ 13‚Äì14 ya≈ü odaklƒ± kreatif i√ßerikler</span>
            <span class="pill">üèü Kul√ºpler & markalar</span>
            <span class="pill">üí¨ Y√∂neticiyle doƒürudan mesaj</span>
          </div>
          <button class="primary-btn" id="btn-info-start">√úye Ol / Giri≈ü Yap</button>
        </div>
        <div class="card">
          <h3>Nasƒ±l √ßalƒ±≈üƒ±yor?</h3>
          <p style="color:var(--muted); font-size:13px;">
            1. √úye ol veya giri≈ü yap.<br>
            2. St√ºdyo ekranƒ±ndan reklam isteƒüi g√∂nder.<br>
            3. Y√∂netici isteƒüini onaylar veya reddeder.<br>
            4. Durumu Ana Sayfa & Bildirimler b√∂l√ºm√ºnden takip edersin.
          </p>
        </div>
      </div>
    </section>

    <!-- Gƒ∞Rƒ∞≈û / √úYE OL -->
    <section class="screen" id="screen-auth">
      <div class="auth-wrapper">
        <div class="auth-title">Hesabƒ±na giri≈ü yap veya yeni bir hesap olu≈ütur</div>
        <div class="auth-sub">
          Hesabƒ±nla giri≈ü yapabilir veya yeni bir √ºyelik olu≈üturup st√ºdyoyu kullanmaya ba≈ülayabilirsin.
        </div>
        <div class="card">
          <div class="auth-tabs">
            <div class="auth-tab active" id="tab-login">Giri≈ü Yap</div>
            <div class="auth-tab" id="tab-register">√úye Ol</div>
          </div>

          <div id="auth-login">
            <div class="field">
              <label for="login-email">E-posta veya kullanƒ±cƒ± adƒ±</label>
              <input id="login-email" type="text" placeholder="√∂r: seninmailin@mail.com" />
            </div>
            <div class="field">
              <label for="login-pass">≈ûifre</label>
              <input id="login-pass" type="password" placeholder="≈üifren" />
            </div>
            <button class="primary-btn btn-full" id="btn-login">Giri≈ü Yap</button>
            <div class="status-text" id="status-login"></div>
          </div>

          <div id="auth-register" style="display:none;">
            <div class="field">
              <label for="reg-name">Adƒ±n</label>
              <input id="reg-name" type="text" placeholder="Adƒ±nƒ± yaz" />
            </div>
            <div class="field">
              <label for="reg-email">E-posta</label>
              <input id="reg-email" type="email" placeholder="ornek@mail.com" />
            </div>
            <div class="field">
              <label for="reg-pass">≈ûifre</label>
              <input id="reg-pass" type="password" placeholder="Bir ≈üifre belirle" />
            </div>
            <button class="primary-btn btn-full" id="btn-register">√úye Ol ve Giri≈ü Yap</button>
            <div class="status-text" id="status-register"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ANA SAYFA / Bƒ∞LDƒ∞Rƒ∞MLER -->
    <section class="screen" id="screen-main">
      <div style="margin-bottom:16px;">
        <div style="font-size:14px; color:var(--accent-soft);" id="welcome-text"></div>
      </div>
      <h2 class="section-title">Bildirimler</h2>
      <p class="section-sub">
        G√∂nderdiƒüin reklam isteklerinin onay / red durumlarƒ±nƒ± buradan takip edebilirsin.
      </p>
      <div class="notif-list" id="notif-list"></div>
    </section>

    <!-- ST√úDYO -->
    <section class="screen" id="screen-studio">
      <h2 class="section-title">St√ºdyo</h2>
      <p class="section-sub">
        Profil bilgilerini g√∂r, reklam isteƒüi g√∂nder ve Y√∂neticiye mesaj bƒ±rak.
      </p>

      <div class="grid-two">
        <div class="card">
          <h3>Profil Bilgilerin</h3>
          <p id="profile-info" style="font-size:13px; color:var(--muted); margin-top:8px;"></p>
        </div>

        <div class="card">
          <h3>Reklam ƒ∞steƒüi G√∂nder</h3>
          <p style="font-size:12px; color:var(--muted); margin-bottom:8px;">
            Hangi kul√ºp/marka i√ßin ne t√ºr bir reklam istediƒüini kƒ±saca yaz.
          </p>
          <div class="field">
            <label for="ad-brand">Kul√ºp / Marka</label>
            <input id="ad-brand" type="text" placeholder="√ñrn: X Spor Kul√ºb√º" />
          </div>
          <div class="field">
            <label for="ad-product">√úr√ºn / Kampanya</label>
            <input id="ad-product" type="text" placeholder="√ñrn: yeni forma lansmanƒ±" />
          </div>
          <div class="field">
            <label for="ad-desc">Detay</label>
            <textarea id="ad-desc" placeholder="Hedef kitle, platform (Instagram, YouTube), tarz (komik, ciddi, vb.)"></textarea>
          </div>
          <button class="primary-btn btn-full" id="btn-send-ad">Reklam ƒ∞steƒüini G√∂nder</button>
          <div class="status-text" id="status-ad"></div>
        </div>

        <div class="card">
          <h3>Y√∂neticiye Mesaj G√∂nder</h3>
          <p style="font-size:12px; color:var(--muted); margin-bottom:8px;">
            √ñnerilerini, sorularƒ±nƒ± veya projelerini buradan Y√∂neticiye iletebilirsin.
          </p>
          <div class="field">
            <label for="msg-subject">Konu</label>
            <input id="msg-subject" type="text" placeholder="Konu ba≈ülƒ±ƒüƒ±" />
          </div>
          <div class="field">
            <label for="msg-body">Mesaj</label>
            <textarea id="msg-body" placeholder="Mesajƒ±nƒ± buraya yaz..."></textarea>
          </div>
          <button class="primary-btn btn-full" id="btn-send-msg">Mesajƒ± G√∂nder</button>
          <div class="status-text" id="status-msg"></div>
        </div>

        <div class="card">
          <h3>Bilgi</h3>
          <p style="font-size:13px; color:var(--muted);">
            Bu st√ºdyo tamamen eƒüitim ama√ßlƒ±dƒ±r. Ger√ßek reklam b√ºt√ßesi yok ama ger√ßek bir ajans gibi
            d√º≈ü√ºnerek kreatif fikirler √ºretmeni saƒülar. üé®
          </p>
        </div>
      </div>
    </section>

    <!-- AYARLAR -->
    <section class="screen" id="screen-settings">
      <h2 class="section-title">Ayarlar</h2>
      <p class="section-sub">
        Tema rengini deƒüi≈ütirebilirsin. Sadece senin cihazƒ±nda ge√ßerli olur.
      </p>
      <div class="card" style="max-width:380px;">
        <div class="field">
          <label for="theme-select">Tema</label>
          <select id="theme-select">
            <option value="dark">Koyu Tema (Varsayƒ±lan)</option>
            <option value="light">A√ßƒ±k Tema</option>
          </select>
        </div>
        <p style="font-size:12px; color:var(--muted);">
          Tema se√ßimin tarayƒ±cƒ±ndaki hafƒ±zaya kaydedilir. Ba≈üka bilgisayarda farklƒ± tema olabilir.
        </p>
      </div>
    </section>

    <!-- Y√ñNETƒ∞Cƒ∞ PANELƒ∞ -->
    <section class="screen" id="screen-admin">
      <div style="margin-bottom:14px; font-size:14px; color:var(--accent-soft);">
        Y√∂netici paneline ho≈ü geldin üëë
      </div>
      <h2 class="section-title">Reklam ƒ∞stekleri, Mesajlar ve √úyeler</h2>
      <p class="section-sub">
        Buradan kullanƒ±cƒ±larƒ±n reklam isteklerini onaylayabilir veya reddedebilir,
        g√∂nderilen mesajlarƒ± ve √ºye listesini g√∂r√ºnt√ºleyebilirsin.
      </p>

      <div class="admin-layout">
        <div>
          <div class="card">
            <h3>Reklam ƒ∞stekleri</h3>
            <div class="admin-list" id="admin-requests"></div>
          </div>

          <div class="card">
            <h3>Kullanƒ±cƒ± Mesajlarƒ±</h3>
            <div class="admin-list" id="admin-messages"></div>
          </div>
        </div>

        <div>
          <div class="card">
            <h3>√úyeler</h3>
            <div class="admin-list" id="admin-users"></div>
          </div>
        </div>
      </div>
    </section>

  </div>
</main>

<footer>
  <div class="container row">
    <span>¬© <span id="year"></span> Spark Ad Studio</span>
  </div>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    onSnapshot,
    doc,
    updateDoc
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // Bu config SENƒ∞N Firebase projen:
  const firebaseConfig = {
    apiKey: "AIzaSyDc6kmOfcRwWLFxPAK0qtB5w_QJkTdHqh8",
    authDomain: "spark-ad-studio.firebaseapp.com",
    projectId: "spark-ad-studio",
    storageBucket: "spark-ad-studio.firebasestorage.app",
    messagingSenderId: "91249468928",
    appId: "1:91249468928:web:6661ecd7e1ff1e92c41ae5",
    measurementId: "G-JW6S3PGH98"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentUser = null;

  const screens = {
    info: document.getElementById("screen-info"),
    auth: document.getElementById("screen-auth"),
    main: document.getElementById("screen-main"),
    studio: document.getElementById("screen-studio"),
    settings: document.getElementById("screen-settings"),
    admin: document.getElementById("screen-admin"),
  };

  const navLinksContainer = document.getElementById("nav-links");
  const navAdmin = document.getElementById("nav-admin");
  const btnAuth = document.getElementById("btn-auth");
  const welcomeText = document.getElementById("welcome-text");
  const profileInfo = document.getElementById("profile-info");
  const notifList = document.getElementById("notif-list");
  const yearSpan = document.getElementById("year");
  yearSpan.textContent = new Date().getFullYear();

  const statusLogin = document.getElementById("status-login");
  const statusRegister = document.getElementById("status-register");
  const statusAd = document.getElementById("status-ad");
  const statusMsg = document.getElementById("status-msg");

  const adminRequestsBox = document.getElementById("admin-requests");
  const adminMessagesBox = document.getElementById("admin-messages");
  const adminUsersBox = document.getElementById("admin-users");

  function setActiveScreen(key) {
    Object.values(screens).forEach(el => el.classList.remove("active"));
    if (screens[key]) screens[key].classList.add("active");

    document.querySelectorAll(".nav-link").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.target === key);
    });
  }

  function updateHeaderState() {
    if (!currentUser) {
      navLinksContainer.style.display = "none";
      btnAuth.textContent = "√úye Ol / Giri≈ü Yap";
    } else {
      navLinksContainer.style.display = "flex";
      btnAuth.textContent = "√áƒ±kƒ±≈ü Yap";
    }

    if (currentUser && currentUser.role === "admin") {
      navAdmin.style.display = "inline-block";
    } else {
      navAdmin.style.display = "none";
    }
  }

  function applyThemeFromStorage() {
    const theme = localStorage.getItem("spark_theme") || "dark";
    document.getElementById("theme-select").value = theme;
    if (theme === "light") {
      document.body.classList.add("light");
    } else {
      document.body.classList.remove("light");
    }
  }

  document.getElementById("theme-select").addEventListener("change", () => {
    const val = document.getElementById("theme-select").value;
    localStorage.setItem("spark_theme", val);
    applyThemeFromStorage();
  });

  applyThemeFromStorage();

  document.getElementById("tab-login").addEventListener("click", () => {
    document.getElementById("tab-login").classList.add("active");
    document.getElementById("tab-register").classList.remove("active");
    document.getElementById("auth-login").style.display = "block";
    document.getElementById("auth-register").style.display = "none";
  });

  document.getElementById("tab-register").addEventListener("click", () => {
    document.getElementById("tab-login").classList.remove("active");
    document.getElementById("tab-register").classList.add("active");
    document.getElementById("auth-login").style.display = "none";
    document.getElementById("auth-register").style.display = "block";
  });

  document.getElementById("btn-info-start").addEventListener("click", () => {
    setActiveScreen("auth");
  });

  btnAuth.addEventListener("click", () => {
    if (!currentUser) {
      setActiveScreen("auth");
    } else {
      currentUser = null;
      localStorage.removeItem("spark_current_user");
      updateHeaderState();
      setActiveScreen("info");
    }
  });

  document.querySelectorAll(".nav-link").forEach(btn => {
    btn.addEventListener("click", () => {
      const target = btn.dataset.target;
      if (!currentUser && target !== "info") {
        setActiveScreen("auth");
        return;
      }
      if (target === "admin" && (!currentUser || currentUser.role !== "admin")) {
        setActiveScreen("main");
        return;
      }
      setActiveScreen(target);
      if (target === "main" && currentUser && currentUser.role === "user") {
        loadNotificationsForUser();
      }
      if (target === "studio" && currentUser && currentUser.role === "user") {
        renderProfile();
      }
    });
  });

  document.getElementById("btn-register").addEventListener("click", async () => {
    statusRegister.textContent = "";
    const name = document.getElementById("reg-name").value.trim();
    const email = document.getElementById("reg-email").value.trim();
    const pass = document.getElementById("reg-pass").value.trim();

    if (!name || !email || !pass) {
      statusRegister.textContent = "L√ºtfen t√ºm alanlarƒ± doldur.";
      return;
    }

    try {
      const usersRef = collection(db, "users");
      const snap = await getDocs(usersRef);
      let exists = false;
      snap.forEach(d => {
        const u = d.data();
        if (u.email === email) exists = true;
      });
      if (exists) {
        statusRegister.textContent = "Bu e-posta zaten kayƒ±tlƒ±.";
        return;
      }

      const now = new Date().toLocaleString("tr-TR");
      const docRef = await addDoc(usersRef, {
        name,
        email,
        pass,
        role: "user",
        createdAt: now,
        lastLogin: now,
      });

      currentUser = {
        id: docRef.id,
        name,
        email,
        role: "user",
        createdAt: now,
        lastLogin: now,
      };
      localStorage.setItem("spark_current_user", JSON.stringify(currentUser));
      statusRegister.textContent = "";
      updateHeaderState();
      welcomeText.textContent = `Ho≈ü geldin, ${currentUser.name} üëã`;
      renderProfile();
      loadNotificationsForUser();
      setActiveScreen("main");
    } catch (err) {
      console.error(err);
      statusRegister.textContent = "Kayƒ±t sƒ±rasƒ±nda bir hata olu≈ütu (Rules ayarlarƒ±nƒ± kontrol et).";
    }
  });

  document.getElementById("btn-login").addEventListener("click", async () => {
    statusLogin.textContent = "";
    const loginVal = document.getElementById("login-email").value.trim();
    const pass = document.getElementById("login-pass").value.trim();

    if (!loginVal || !pass) {
      statusLogin.textContent = "L√ºtfen kullanƒ±cƒ± adƒ±/e-posta ve ≈üifre gir.";
      return;
    }

    // Gizli Y√∂netici giri≈üi (ekranda yazmƒ±yoruz, sadece sen biliyorsun)
    if (loginVal === "admin" && pass === "spark123") {
      currentUser = {
        id: "ADMIN",
        name: "Y√∂netici",
        email: "admin@sparkad.studio",
        role: "admin",
      };
      localStorage.setItem("spark_current_user", JSON.stringify(currentUser));
      statusLogin.textContent = "Y√∂netici olarak giri≈ü yapƒ±ldƒ±.";
      updateHeaderState();
      setActiveScreen("admin");
      return;
    }

    try {
      const usersRef = collection(db, "users");
      const snap = await getDocs(usersRef);
      let found = null;
      snap.forEach(d => {
        const u = d.data();
        if ((u.email === loginVal || u.name === loginVal) && u.pass === pass) {
          found = { id: d.id, ...u };
        }
      });

      if (!found) {
        statusLogin.textContent = "Kullanƒ±cƒ± bulunamadƒ± veya ≈üifre hatalƒ±.";
        return;
      }

      const now = new Date().toLocaleString("tr-TR");
      try {
        await updateDoc(doc(db, "users", found.id), { lastLogin: now });
      } catch (e) {}
      found.lastLogin = now;

      currentUser = found;
      localStorage.setItem("spark_current_user", JSON.stringify(currentUser));
      statusLogin.textContent = "";
      updateHeaderState();

      if (currentUser.role === "admin") {
        setActiveScreen("admin");
      } else {
        welcomeText.textContent = `Ho≈ü geldin, ${currentUser.name} üëã`;
        renderProfile();
        loadNotificationsForUser();
        setActiveScreen("main");
      }
    } catch (err) {
      console.error(err);
      statusLogin.textContent = "Sunucuya baƒülanƒ±rken hata olu≈ütu (muhtemelen Firestore Rules engelliyor).";
    }
  });

  function renderProfile() {
    if (!currentUser || currentUser.role !== "user") return;
    profileInfo.innerHTML = `
      Ad: <strong>${currentUser.name}</strong><br>
      E-posta: ${currentUser.email}<br>
      √úyelik: ${currentUser.createdAt || "-"}<br>
      Son giri≈ü: ${currentUser.lastLogin || "-"}
    `;
  }

  async function loadNotificationsForUser() {
    if (!currentUser || currentUser.role !== "user") return;
    try {
      const reqRef = collection(db, "requests");
      const snap = await getDocs(reqRef);
      const my = [];
      snap.forEach(d => {
        const r = d.data();
        if (r.userEmail === currentUser.email) my.push(r);
      });

      if (!my.length) {
        notifList.innerHTML = `<div>Hen√ºz reklam isteƒüin yok. St√ºdyo ekranƒ±ndan yeni bir istek g√∂nderebilirsin.</div>`;
        return;
      }

      my.sort((a, b) => (a.createdAt || "").localeCompare(b.createdAt || ""));
      notifList.innerHTML = my.map(r => {
        let cls = "s-pending";
        let txt = "Beklemede";
        if (r.status === "approved") {
          cls = "s-approved";
          txt = "Onaylandƒ±";
        } else if (r.status === "rejected") {
          cls = "s-rejected";
          txt = "Reddedildi";
        }
        return `
          <div class="notif-item">
            <div class="notif-meta">
              ${r.createdAt || ""} ‚Äì <strong>${r.brand}</strong> (${r.product})
              <span class="pill-status ${cls}">${txt}</span>
            </div>
            <div>${r.details}</div>
            ${r.adminNote ? `<div style="font-size:12px; margin-top:4px;">Y√∂netici notu: ${r.adminNote}</div>` : ""}
          </div>
        `;
      }).join("");
    } catch (err) {
      console.error(err);
      notifList.innerHTML = "<div>Bildirimler y√ºklenirken hata olu≈ütu.</div>";
    }
  }

  document.getElementById("btn-send-ad").addEventListener("click", async () => {
    statusAd.textContent = "";
    if (!currentUser || currentUser.role !== "user") {
      statusAd.textContent = "√ñnce kullanƒ±cƒ± olarak giri≈ü yapmalƒ±sƒ±n.";
      return;
    }
    const brand = document.getElementById("ad-brand").value.trim();
    const product = document.getElementById("ad-product").value.trim();
    const desc = document.getElementById("ad-desc").value.trim();

    if (!brand || !product || !desc) {
      statusAd.textContent = "L√ºtfen t√ºm alanlarƒ± doldur.";
      return;
    }

    try {
      const now = new Date().toLocaleString("tr-TR");
      await addDoc(collection(db, "requests"), {
        userName: currentUser.name,
        userEmail: currentUser.email,
        brand,
        product,
        details: desc,
        status: "pending",
        adminNote: "",
        createdAt: now,
      });

      document.getElementById("ad-brand").value = "";
      document.getElementById("ad-product").value = "";
      document.getElementById("ad-desc").value = "";
      statusAd.textContent = "Reklam isteƒüin Y√∂neticiye g√∂nderildi.";
      loadNotificationsForUser();
    } catch (err) {
      console.error(err);
      statusAd.textContent = "Reklam isteƒüi g√∂nderilirken hata olu≈ütu.";
    }
  });

  document.getElementById("btn-send-msg").addEventListener("click", async () => {
    statusMsg.textContent = "";
    if (!currentUser || currentUser.role !== "user") {
      statusMsg.textContent = "√ñnce kullanƒ±cƒ± olarak giri≈ü yapmalƒ±sƒ±n.";
      return;
    }
    const subject = document.getElementById("msg-subject").value.trim();
    const body = document.getElementById("msg-body").value.trim();
    if (!subject || !body) {
      statusMsg.textContent = "Konu ve mesaj dolu olmalƒ±.";
      return;
    }
    try {
      const now = new Date().toLocaleString("tr-TR");
      await addDoc(collection(db, "messages"), {
        fromName: currentUser.name,
        fromEmail: currentUser.email,
        subject,
        body,
        createdAt: now,
      });
      document.getElementById("msg-subject").value = "";
      document.getElementById("msg-body").value = "";
      statusMsg.textContent = "Mesajƒ±n Y√∂neticiye iletildi.";
    } catch (err) {
      console.error(err);
      statusMsg.textContent = "Mesaj g√∂nderilirken hata olu≈ütu.";
    }
  });

  onSnapshot(collection(db, "requests"), (snap) => {
    const list = [];
    snap.forEach(d => list.push({ id: d.id, ...d.data() }));
    renderAdminRequests(list);
  });

  onSnapshot(collection(db, "messages"), (snap) => {
    const list = [];
    snap.forEach(d => list.push({ id: d.id, ...d.data() }));
    renderAdminMessages(list);
  });

  onSnapshot(collection(db, "users"), (snap) => {
    const list = [];
    snap.forEach(d => list.push({ id: d.id, ...d.data() }));
    renderAdminUsers(list);
  });

  function renderAdminRequests(list) {
    if (!list.length) {
      adminRequestsBox.innerHTML = "<div>Hen√ºz reklam isteƒüi yok.</div>";
      return;
    }
    list.sort((a, b) => (a.createdAt || "").localeCompare(b.createdAt || ""));
    adminRequestsBox.innerHTML = list.map(r => {
      let cls = "s-pending";
      let txt = "Beklemede";
      if (r.status === "approved") { cls = "s-approved"; txt = "Onaylandƒ±"; }
      else if (r.status === "rejected") { cls = "s-rejected"; txt = "Reddedildi"; }
      const approvedLocked = r.status === "approved";
      return `
        <div class="admin-item">
          <div class="admin-meta">
            ${r.createdAt || ""} ‚Äì <strong>${r.brand}</strong> (${r.product}) |
            ${r.userName} (${r.userEmail})
            <span class="pill-status ${cls}">${txt}</span>
          </div>
          <div>${r.details}</div>
          ${r.adminNote ? `<div>Y√∂netici notu: ${r.adminNote}</div>` : ""}
          <div class="admin-actions">
            <input type="text" id="note-${r.id}" placeholder="Kƒ±sa not (opsiyonel)" />
            <button class="btn-small btn-approve" data-id="${r.id}" data-status="approved" ${approvedLocked ? "disabled" : ""}>Onayla</button>
            <button class="btn-small btn-reject" data-id="${r.id}" data-status="rejected" ${approvedLocked ? "disabled" : ""}>Reddet</button>
          </div>
          ${approvedLocked ? `<div style="font-size:11px;color:#4ade80;margin-top:3px;">Bu istek onaylandƒ±, tekrar reddedilemez.</div>` : ""}
        </div>
      `;
    }).join("");

    adminRequestsBox.querySelectorAll("button[data-id]").forEach(btn => {
      btn.addEventListener("click", async () => {
        if (!currentUser || currentUser.role !== "admin") return;
        const id = btn.dataset.id;
        const newStatus = btn.dataset.status;
        const noteInput = document.getElementById(`note-${id}`);
        const adminNote = noteInput ? noteInput.value.trim() : "";
        try {
          const ref = doc(db, "requests", id);

          // Onaylanmƒ±≈ü isteƒüi reddetme korumasƒ±:
          const allSnap = await getDocs(collection(db, "requests"));
          let current = null;
          allSnap.forEach(d => {
            if (d.id === id) current = d.data();
          });
          if (current && current.status === "approved" && newStatus === "rejected") {
            alert("Onaylanan bir istek reddedilemez.");
            return;
          }

          await updateDoc(ref, { status: newStatus, adminNote });
        } catch (err) {
          console.error(err);
          alert("Durum g√ºncellenirken hata olu≈ütu.");
        }
      });
    });
  }

  function renderAdminMessages(list) {
    if (!list.length) {
      adminMessagesBox.innerHTML = "<div>Hen√ºz mesaj yok.</div>";
      return;
    }
    list.sort((a, b) => (a.createdAt || "").localeCompare(b.createdAt || ""));
    adminMessagesBox.innerHTML = list.map(m => `
      <div class="admin-item">
        <div class="admin-meta">
          ${m.createdAt || ""} ‚Äì <strong>${m.fromName}</strong> (${m.fromEmail}) ‚Äì ${m.subject}
        </div>
        <div>${m.body}</div>
      </div>
    `).join("");
  }

  function renderAdminUsers(list) {
    if (!list.length) {
      adminUsersBox.innerHTML = "<div>Hen√ºz √ºye yok.</div>";
      return;
    }
    list.sort((a, b) => (a.createdAt || "").localeCompare(b.createdAt || ""));
    adminUsersBox.innerHTML = list.map(u => `
      <div class="admin-item">
        <div class="admin-meta">
          Kullanƒ±cƒ±: <strong>${u.name}</strong> (${u.email})
        </div>
        <div>√úyelik: ${u.createdAt || "-"}</div>
        <div>Son giri≈ü: ${u.lastLogin || "-"}</div>
      </div>
    `).join("");
  }

  (function initFromStorage() {
    const raw = localStorage.getItem("spark_current_user");
    if (raw) {
      try {
        currentUser = JSON.parse(raw);
      } catch (e) {
        currentUser = null;
      }
    }
    updateHeaderState();
    if (currentUser) {
      if (currentUser.role === "admin") {
        setActiveScreen("admin");
      } else {
        welcomeText.textContent = `Ho≈ü geldin, ${currentUser.name} üëã`;
        renderProfile();
        loadNotificationsForUser();
        setActiveScreen("main");
      }
    } else {
      setActiveScreen("info");
    }
  })();

</script>

</body>
</html>
