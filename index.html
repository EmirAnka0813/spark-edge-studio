<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>Spark Ad Studio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #050816;
      --bg-alt: #0b1020;
      --card: #111827;
      --accent: #ff7a3c;
      --accent-soft: #ffd2aa;
      --text: #f9fafb;
      --muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.35);
      --radius-lg: 18px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1f2937 0, #050816 55%, #020617 100%);
      color: var(--text);
      min-height: 100vh;
    }

    body.light {
      --bg: #f3f4f6;
      --bg-alt: #e5e7eb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border-subtle: rgba(148, 163, 184, 0.5);
      background: linear-gradient(to bottom, #e5e7eb, #f9fafb);
    }

    a { color: inherit; text-decoration: none; }

    .container { width: min(1100px, 92vw); margin: 0 auto; }

    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(18px);
      background: linear-gradient(to bottom, rgba(5, 8, 22, 0.95), transparent);
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
    }

    body.light header {
      background: linear-gradient(to bottom, rgba(243, 244, 246, 0.95), transparent);
      border-bottom-color: rgba(209, 213, 219, 0.9);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      gap: 16px;
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-logo {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0, var(--accent), #7c2d12);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 16px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
      color: #111827;
    }

    body.light .nav-logo {
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.25);
      color: #111827;
    }

    .nav-titles { display: flex; flex-direction: column; gap: 2px; }

    .nav-title { font-weight: 700; letter-spacing: 0.03em; font-size: 18px; }

    .nav-sub {
      font-size: 11px;
      text-transform: uppercase;
      color: var(--muted);
      letter-spacing: 0.12em;
    }

    .nav-right { display: flex; align-items: center; gap: 14px; }

    .nav-links { display: flex; gap: 10px; font-size: 13px; color: var(--muted); }

    .nav-link {
      border: none;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 999px;
    }

    .nav-link:hover { color: var(--accent); }

    .nav-link.active {
      color: var(--accent);
      font-weight: 600;
    }

    .nav-cta {
      border: none;
      cursor: pointer;
      padding: 7px 14px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      background: linear-gradient(135deg, var(--accent), #fb7185);
      color: #111827;
      box-shadow: 0 12px 28px rgba(0, 0, 0, 0.6);
    }

    body.light .nav-cta {
      color: #111827;
      box-shadow: 0 12px 25px rgba(15, 23, 42, 0.25);
    }

    main { padding-bottom: 40px; }

    .screen { display: none; padding: 32px 0; }
    .screen.active { display: block; }

    .info-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 24px;
      align-items: center;
    }

    @media (max-width: 840px) {
      .info-layout { grid-template-columns: 1fr; }
    }

    .kicker {
      font-size: 11px;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--accent-soft);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .k-dot { width: 7px; height: 7px; border-radius: 999px; background: var(--accent); }

    .hero-title {
      font-size: clamp(30px, 4vw, 36px);
      font-weight: 700;
      margin-bottom: 8px;
    }

    .hero-title span {
      background: linear-gradient(135deg, var(--accent), #fb7185, #a855f7);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-lead {
      font-size: 14px;
      color: var(--muted);
      max-width: 520px;
      margin-bottom: 18px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 18px;
      font-size: 11px;
    }

    .pill {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      color: var(--accent-soft);
      background: rgba(15, 23, 42, 0.8);
    }

    body.light .pill {
      background: rgba(255, 255, 255, 0.8);
      color: #7c2d12;
    }

    .primary-btn {
      border: none;
      cursor: pointer;
      padding: 10px 18px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), #fb7185);
      color: #111827;
      font-weight: 600;
      font-size: 13px;
      box-shadow: 0 16px 36px rgba(0, 0, 0, 0.6);
    }

    .card {
      background: radial-gradient(circle at top left, rgba(248, 250, 252, 0.08), transparent 55%),
                  var(--card);
      border-radius: var(--radius-lg);
      padding: 16px 16px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.6);
      font-size: 13px;
    }

    body.light .card { box-shadow: 0 12px 26px rgba(15, 23, 42, 0.18); }

    .card h3 { font-size: 15px; margin-bottom: 6px; }

    .auth-wrapper { max-width: 420px; margin: 0 auto; }

    .auth-title { font-size: 20px; text-align: center; margin-bottom: 8px; }

    .auth-sub {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      margin-bottom: 18px;
    }

    .auth-tabs {
      display: flex;
      background: rgba(15, 23, 42, 0.9);
      padding: 3px;
      border-radius: 999px;
      margin-bottom: 12px;
    }

    body.light .auth-tabs { background: rgba(229, 231, 235, 0.9); }

    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 6px 0;
      font-size: 13px;
      border-radius: 999px;
      cursor: pointer;
      color: var(--muted);
    }

    .auth-tab.active {
      background: linear-gradient(135deg, var(--accent), #fb7185);
      color: #111827;
      font-weight: 600;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    .field label { font-size: 12px; color: var(--muted); }

    .field input,
    .field textarea,
    .field select {
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      padding: 8px 10px;
      font-size: 13px;
      background: rgba(15, 23, 42, 0.8);
      color: var(--text);
      outline: none;
    }

    body.light .field input,
    body.light .field textarea,
    body.light .field select {
      background: #f9fafb;
      color: #111827;
      border-color: rgba(148, 163, 184, 0.6);
    }

    .field textarea { min-height: 90px; resize: vertical; }

    .btn-full { width: 100%; margin-top: 4px; }

    .status-text {
      font-size: 12px;
      color: var(--accent-soft);
      min-height: 16px;
      margin-top: 6px;
    }

    .section-title { font-size: 20px; margin-bottom: 4px; }

    .section-sub { font-size: 13px; color: var(--muted); margin-bottom: 16px; }

    .notif-list {
      border-radius: 14px;
      border: 1px solid var(--border-subtle);
      background: rgba(15, 23, 42, 0.9);
      padding: 10px;
      font-size: 13px;
    }

    body.light .notif-list { background: rgba(255, 255, 255, 0.85); }

    .notif-item {
      padding: 8px 6px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .notif-item:last-child { border-bottom: none; }

    .notif-meta {
      font-size: 11px;
      color: var(--accent-soft);
      margin-bottom: 2px;
    }

    .pill-status {
      display: inline-block;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 10px;
      margin-left: 6px;
    }

    .s-pending { background: rgba(234, 179, 8, 0.15); color: #facc15; }
    .s-approved { background: rgba(22, 163, 74, 0.2); color: #4ade80; }
    .s-rejected { background: rgba(239, 68, 68, 0.18); color: #fca5a5; }

    .grid-two {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 16px;
    }

    @media (max-width: 840px) {
      .grid-two { grid-template-columns: 1fr; }
    }

    .admin-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 16px;
    }

    @media (max-width: 960px) {
      .admin-layout { grid-template-columns: 1fr; }
    }

    .admin-list {
      max-height: 260px;
      overflow-y: auto;
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 8px;
      font-size: 12px;
      background: rgba(15, 23, 42, 0.9);
    }

    body.light .admin-list { background: rgba(255, 255, 255, 0.9); }

    .admin-item {
      padding: 6px 4px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .admin-item:last-child { border-bottom: none; }

    .admin-meta {
      font-size: 11px;
      color: var(--accent-soft);
      margin-bottom: 2px;
    }

    .admin-actions {
      margin-top: 4px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .admin-actions input {
      flex: 1;
      min-width: 120px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
    }

    .btn-small {
      border-radius: 999px;
      border: none;
      font-size: 11px;
      padding: 4px 9px;
      cursor: pointer;
    }

    .btn-approve { background: rgba(22, 163, 74, 0.9); color: #e5f9ed; }
    .btn-reject { background: rgba(239, 68, 68, 0.9); color: #fee2e2; }

    footer {
      padding: 18px 0 28px;
      font-size: 12px;
      color: var(--muted);
    }

    footer .row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>

<header>
  <div class="container nav">
    <div class="nav-left">
      <div class="nav-logo">SA</div>
      <div class="nav-titles">
        <div class="nav-title">Spark Ad Studio</div>
        <div class="nav-sub">kulÃ¼pler & markalar iÃ§in mini stÃ¼dyo</div>
      </div>
    </div>
    <div class="nav-right">
      <div class="nav-links" id="nav-links" style="display:none;">
        <button class="nav-link" data-target="info" id="nav-info">Bilgi</button>
        <button class="nav-link" data-target="main" id="nav-main">Ana Sayfa</button>
        <button class="nav-link" data-target="studio" id="nav-studio">StÃ¼dyo</button>
        <button class="nav-link" data-target="settings" id="nav-settings">Ayarlar</button>
        <button class="nav-link" data-target="admin" id="nav-admin" style="display:none;">YÃ¶netici</button>
      </div>
      <button class="nav-cta" id="btn-auth">Ãœye Ol / GiriÅŸ Yap</button>
    </div>
  </div>
</header>

<main>
  <div class="container">

    <!-- BÄ°LGÄ° / LANDING -->
    <section class="screen active" id="screen-info">
      <div class="info-layout">
        <div>
          <div class="kicker">
            <span class="k-dot"></span> GENÃ‡ ZEKÃ‚LAR Ä°Ã‡Ä°N REKLAM STÃœDYOSU
          </div>
          <h1 class="hero-title">
            <span>Spark Ad Studio</span> ile kulÃ¼pler ve markalar iÃ§in eÄŸlenceli reklam fikirleri.
          </h1>
          <p class="hero-lead">
            Reklam isteyen kulÃ¼pler kÄ±sa bir form dolduruyor, sen de onlarÄ±n istediÄŸi ÅŸeye gÃ¶re
            akÄ±lda kalÄ±cÄ± dijital iÃ§erik fikirleri Ã¼retiyorsun. YÃ¶netici panelinden gelen istekleri
            gÃ¶rÃ¼p takip edebiliyorsun.
          </p>
          <div class="pill-row">
            <span class="pill">ğŸ¯ 13â€“14 yaÅŸ odaklÄ± kreatif iÃ§erikler</span>
            <span class="pill">ğŸŸ KulÃ¼pler & markalar</span>
            <span class="pill">ğŸ’¬ YÃ¶neticiyle doÄŸrudan mesaj</span>
          </div>
          <button class="primary-btn" id="btn-info-start">Ãœye Ol / GiriÅŸ Yap</button>
        </div>
        <div class="card">
          <h3>NasÄ±l Ã§alÄ±ÅŸÄ±yor?</h3>
          <p style="color:var(--muted); font-size:13px;">
            1. Ãœye ol veya giriÅŸ yap.<br>
            2. StÃ¼dyo ekranÄ±ndan reklam isteÄŸi gÃ¶nder.<br>
            3. YÃ¶netici isteÄŸini onaylar veya reddeder.<br>
            4. Durumu Ana Sayfa & Bildirimler bÃ¶lÃ¼mÃ¼nden takip edersin.
          </p>
        </div>
      </div>
    </section>

    <!-- GÄ°RÄ°Å / ÃœYE OL -->
    <section class="screen" id="screen-auth">
      <div class="auth-wrapper">
        <div class="auth-title">HesabÄ±na giriÅŸ yap veya yeni bir hesap oluÅŸtur</div>
        <div class="auth-sub">
          HesabÄ±nla giriÅŸ yapabilir veya yeni bir Ã¼yelik oluÅŸturup stÃ¼dyoyu kullanmaya baÅŸlayabilirsin.
        </div>
        <div class="card">
          <div class="auth-tabs">
            <div class="auth-tab active" id="tab-login">GiriÅŸ Yap</div>
            <div class="auth-tab" id="tab-register">Ãœye Ol</div>
          </div>

          <div id="auth-login">
            <div class="field">
              <label for="login-email">E-posta veya kullanÄ±cÄ± adÄ±</label>
              <input id="login-email" type="text" placeholder="Ã¶r: seninmailin@mail.com" />
            </div>
            <div class="field">
              <label for="login-pass">Åifre</label>
              <input id="login-pass" type="password" placeholder="ÅŸifren" />
            </div>
            <button class="primary-btn btn-full" id="btn-login">GiriÅŸ Yap</button>
            <div class="status-text" id="status-login"></div>
          </div>

          <div id="auth-register" style="display:none;">
            <div class="field">
              <label for="reg-name">AdÄ±n</label>
              <input id="reg-name" type="text" placeholder="AdÄ±nÄ± yaz" />
            </div>
            <div class="field">
              <label for="reg-email">E-posta</label>
              <input id="reg-email" type="email" placeholder="ornek@mail.com" />
            </div>
            <div class="field">
              <label for="reg-pass">Åifre</label>
              <input id="reg-pass" type="password" placeholder="Bir ÅŸifre belirle" />
            </div>
            <button class="primary-btn btn-full" id="btn-register">Ãœye Ol ve GiriÅŸ Yap</button>
            <div class="status-text" id="status-register"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- ANA SAYFA / BÄ°LDÄ°RÄ°MLER -->
    <section class="screen" id="screen-main">
      <div style="margin-bottom:16px;">
        <div style="font-size:14px; color:var(--accent-soft);" id="welcome-text"></div>
      </div>
      <h2 class="section-title">Bildirimler</h2>
      <p class="section-sub">
        GÃ¶nderdiÄŸin reklam isteklerinin onay / red durumlarÄ±nÄ± buradan takip edebilirsin.
      </p>
      <div class="notif-list" id="notif-list"></div>
    </section>

    <!-- STÃœDYO -->
    <section class="screen" id="screen-studio">
      <h2 class="section-title">StÃ¼dyo</h2>
      <p class="section-sub">
        Profil bilgilerini gÃ¶r, reklam isteÄŸi gÃ¶nder ve YÃ¶neticiye mesaj bÄ±rak.
      </p>

      <div class="grid-two">
        <div class="card">
          <h3>Profil Bilgilerin</h3>
          <p id="profile-info" style="font-size:13px; color:var(--muted); margin-top:8px;"></p>
        </div>

        <div class="card">
          <h3>Reklam Ä°steÄŸi GÃ¶nder</h3>
          <p style="font-size:12px; color:var(--muted); margin-bottom:8px;">
            Hangi kulÃ¼p/marka iÃ§in ne tÃ¼r bir reklam istediÄŸini kÄ±saca yaz.
          </p>
          <div class="field">
            <label for="ad-brand">KulÃ¼p / Marka</label>
            <input id="ad-brand" type="text" placeholder="Ã–rn: X Spor KulÃ¼bÃ¼" />
          </div>
          <div class="field">
            <label for="ad-product">ÃœrÃ¼n / Kampanya</label>
            <input id="ad-product" type="text" placeholder="Ã–rn: yeni forma lansmanÄ±" />
          </div>
          <div class="field">
            <label for="ad-desc">Detay</label>
            <textarea id="ad-desc" placeholder="Hedef kitle, platform (Instagram, YouTube), tarz (komik, ciddi, vb.)"></textarea>
          </div>
          <button class="primary-btn btn-full" id="btn-send-ad">Reklam Ä°steÄŸini GÃ¶nder</button>
          <div class="status-text" id="status-ad"></div>
        </div>

        <div class="card">
          <h3>YÃ¶neticiye Mesaj GÃ¶nder</h3>
          <p style="font-size:12px; color:var(--muted); margin-bottom:8px;">
            Ã–nerilerini, sorularÄ±nÄ± veya projelerini buradan YÃ¶neticiye iletebilirsin.
          </p>
          <div class="field">
            <label for="msg-subject">Konu</label>
            <input id="msg-subject" type="text" placeholder="Konu baÅŸlÄ±ÄŸÄ±" />
          </div>
          <div class="field">
            <label for="msg-body">Mesaj</label>
            <textarea id="msg-body" placeholder="MesajÄ±nÄ± buraya yaz..."></textarea>
          </div>
          <button class="primary-btn btn-full" id="btn-send-msg">MesajÄ± GÃ¶nder</button>
          <div class="status-text" id="status-msg"></div>
        </div>

        <div class="card">
          <h3>Bilgi</h3>
          <p style="font-size:13px; color:var(--muted);">
            Bu stÃ¼dyo tamamen eÄŸitim amaÃ§lÄ±dÄ±r. GerÃ§ek reklam bÃ¼tÃ§esi yok ama gerÃ§ek bir ajans gibi
            dÃ¼ÅŸÃ¼nerek kreatif fikirler Ã¼retmeni saÄŸlar. ğŸ¨
          </p>
        </div>
      </div>
    </section>

    <!-- AYARLAR -->
    <section class="screen" id="screen-settings">
      <h2 class="section-title">Ayarlar</h2>
      <p class="section-sub">
        Tema ve vurgu rengini deÄŸiÅŸtirebilirsin.
      </p>
      <div class="card" style="max-width:420px;">
        <div class="field">
          <label for="theme-select">Tema</label>
          <select id="theme-select">
            <option value="dark">Koyu Tema (VarsayÄ±lan)</option>
            <option value="light">AÃ§Ä±k Tema</option>
          </select>
        </div>
        <div class="field">
          <label for="accent-select">Vurgu Rengi</label>
          <select id="accent-select">
            <option value="orange">Turuncu (VarsayÄ±lan)</option>
            <option value="blue">Mavi</option>
            <option value="green">YeÅŸil</option>
            <option value="purple">Mor</option>
          </select>
        </div>
        <p style="font-size:12px; color:var(--muted);">
          Tema ve renk seÃ§imin bu tarayÄ±cÄ±da kaydedilir. BaÅŸka bir bilgisayarda farklÄ± ayarlar olabilir.
        </p>
      </div>
    </section>

    <!-- YÃ–NETÄ°CÄ° PANELÄ° -->
    <section class="screen" id="screen-admin">
      <div style="margin-bottom:14px; font-size:14px; color:var(--accent-soft);">
        YÃ¶netici paneline hoÅŸ geldin ğŸ‘‘
      </div>
      <h2 class="section-title">Reklam Ä°stekleri, Mesajlar ve Ãœyeler</h2>
      <p class="section-sub">
        Buradan kullanÄ±cÄ±larÄ±n reklam isteklerini onaylayabilir veya reddedebilir,
        gÃ¶nderilen mesajlarÄ± ve Ã¼ye listesini gÃ¶rÃ¼ntÃ¼leyebilirsin.
      </p>

      <div class="admin-layout">
        <div>
          <div class="card">
            <h3>Reklam Ä°stekleri</h3>
            <div class="admin-list" id="admin-requests"></div>
          </div>

          <div class="card">
            <h3>KullanÄ±cÄ± MesajlarÄ±</h3>
            <div class="admin-list" id="admin-messages"></div>
          </div>
        </div>

        <div>
          <div class="card">
            <h3>Ãœyeler</h3>
            <div class="admin-list" id="admin-users"></div>
          </div>
        </div>
      </div>
    </section>

  </div>
</main>

<footer>
  <div class="container row">
    <span>Â© <span id="year"></span> Spark Ad Studio</span>
  </div>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    onSnapshot,
    doc,
    updateDoc
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDc6kmOfcRwWLFxPAK0qtB5w_QJkTdHqh8",
    authDomain: "spark-ad-studio.firebaseapp.com",
    projectId: "spark-ad-studio",
    storageBucket: "spark-ad-studio.firebasestorage.app",
    messagingSenderId: "91249468928",
    appId: "1:91249468928:web:6661ecd7e1ff1e92c41ae5",
    measurementId: "G-JW6S3PGH98"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentUser = null;

  const screens = {
    info: document.getElementById("screen-info"),
    auth: document.getElementById("screen-auth"),
    main: document.getElementById("screen-main"),
    studio: document.getElementById("screen-studio"),
    settings: document.getElementById("screen-settings"),
    admin: document.getElementById("screen-admin"),
  };

  const navLinksContainer = document.getElementById("nav-links");
  const navAdmin = document.getElementById("nav-admin");
  const btnAuth = document.getElementById("btn-auth");
  const welcomeText = document.getElementById("welcome-text");
  const profileInfo = document.getElementById("profile-info");
  const notifList = document.getElementById("notif-list");
  const yearSpan = document.getElementById("year");
  yearSpan.textContent = new Date().getFullYear();

  const statusLogin = document.getElementById("status-login");
  const statusRegister = document.getElementById("status-register");
  const statusAd = document.getElementById("status-ad");
  const statusMsg = document.getElementById("status-msg");

  const adminRequestsBox = document.getElementById("admin-requests");
  const adminMessagesBox = document.getElementById("admin-messages");
  const adminUsersBox = document.getElementById("admin-users");

  function setActiveScreen(key) {
    Object.values(screens).forEach(el => el.classList.remove("active"));
    if (screens[key]) screens[key].classList.add("active");

    document.querySelectorAll(".nav-link").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.target === key);
    });
  }

  function updateHeaderState() {
    if (!currentUser) {
      navLinksContainer.style.display = "none";
      btnAuth.textContent = "Ãœye Ol / GiriÅŸ Yap";
    } else {
      navLinksContainer.style.display = "flex";
      btnAuth.textContent = "Ã‡Ä±kÄ±ÅŸ Yap";
    }

    if (currentUser && currentUser.role === "admin") {
      navAdmin.style.display = "inline-block";
    } else {
      navAdmin.style.display = "none";
    }
  }

  function applyThemeFromStorage() {
    const theme = localStorage.getItem("spark_theme") || "dark";
    const accent = localStorage.getItem("spark_accent") || "orange";

    document.getElementById("theme-select").value = theme;
    document.getElementById("accent-select").value = accent;

    if (theme === "light") {
      document.body.classList.add("light");
    } else {
      document.body.classList.remove("light");
    }

    applyAccent(accent);
  }

  function applyAccent(accentKey) {
    let accent = "#ff7a3c";
    let soft = "#ffd2aa";

    if (accentKey === "blue") {
      accent = "#3b82f6";
      soft = "#bfdbfe";
    } else if (accentKey === "green") {
      accent = "#22c55e";
      soft = "#bbf7d0";
    } else if (accentKey === "purple") {
      accent = "#a855f7";
      soft = "#e9d5ff";
    }

    document.documentElement.style.setProperty("--accent", accent);
    document.documentElement.style.setProperty("--accent-soft", soft);
  }

  document.getElementById("theme-select").addEventListener("change", () => {
    const val = document.getElementById("theme-select").value;
    localStorage.setItem("spark_theme", val);
    applyThemeFromStorage();
  });

  document.getElementById("accent-select").addEventListener("change", () => {
    const val = document.getElementById("accent-select").value;
    localStorage.setItem("spark_accent", val);
    applyThemeFromStorage();
  });

  applyThemeFromStorage();

  document.getElementById("tab-login").addEventListener("click", () => {
    document.getElementById("tab-login").classList.add("active");
    document.getElementById("tab-register").classList.remove("active");
    document.getElementById("auth-login").style.display = "block";
    document.getElementById("auth-register").style.display = "none";
  });

  document.getElementById("tab-register").addEventListener("click", () => {
    document.getElementById("tab-login").classList.remove("active");
    document.getElementById("tab-register").classList.add("active");
    document.getElementById("auth-login").style.display = "none";
    document.getElementById("auth-register").style.display = "block";
  });

  document.getElementById("btn-info-start").addEventListener("click", () => {
    setActiveScreen("auth");
  });

  btnAuth.addEventListener("click", () => {
    if (!currentUser) {
      setActiveScreen("auth");
    } else {
      currentUser = null;
      localStorage.removeItem("spark_current_user");
      updateHeaderState();
      setActiveScreen("info");
    }
  });

  document.querySelectorAll(".nav-link").forEach(btn => {
    btn.addEventListener("click", () => {
      const target = btn.dataset.target;
      if (!currentUser && target !== "info") {
        setActiveScreen("auth");
        return;
      }
      if (target === "admin" && (!currentUser || currentUser.role !== "admin")) {
        setActiveScreen("main");
        return;
      }
      setActiveScreen(target);
      if (target === "main" && currentUser && currentUser.role === "user") {
        loadNotificationsForUser();
      }
      if (target === "studio" && currentUser && currentUser.role === "user") {
        renderProfile();
      }
    });
  });

  document.getElementById("btn-register").addEventListener("click", async () => {
    statusRegister.textContent = "";
    const name = document.getElementById("reg-name").value.trim();
    const email = document.getElementById("reg-email").value.trim();
    const pass = document.getElementById("reg-pass").value.trim();

    if (!name || !email || !pass) {
      statusRegister.textContent = "LÃ¼tfen tÃ¼m alanlarÄ± doldur.";
      return;
    }

    try {
      const usersRef = collection(db, "users");
      const snap = await getDocs(usersRef);
      let exists = false;
      snap.forEach(d => {
        const u = d.data();
        if (u.email === email) exists = true;
      });
      if (exists) {
        statusRegister.textContent = "Bu e-posta zaten kayÄ±tlÄ±.";
        return;
      }

      const now = new Date().toLocaleString("tr-TR");
      const docRef = await addDoc(usersRef, {
        name,
        email,
        pass,
        role: "user",
        createdAt: now,
        lastLogin: now,
      });

      currentUser = {
        id: docRef.id,
        name,
        email,
        role: "user",
        createdAt: now,
        lastLogin: now,
      };
      localStorage.setItem("spark_current_user", JSON.stringify(currentUser));
      statusRegister.textContent = "";
      updateHeaderState();
      welcomeText.textContent = `HoÅŸ geldin, ${currentUser.name} ğŸ‘‹`;
      renderProfile();
      loadNotificationsForUser();
      setActiveScreen("main");
    } catch (err) {
      console.error(err);
      statusRegister.textContent = "KayÄ±t sÄ±rasÄ±nda hata oluÅŸtu. Firestore Rules ayarÄ±nÄ± kontrol et.";
    }
  });

  document.getElementById("btn-login").addEventListener("click", async () => {
    statusLogin.textContent = "";
    const loginVal = document.getElementById("login-email").value.trim();
    const pass = document.getElementById("login-pass").value.trim();

    if (!loginVal || !pass) {
      statusLogin.textContent = "LÃ¼tfen kullanÄ±cÄ± adÄ±/e-posta ve ÅŸifre gir.";
      return;
    }

    // Gizli yÃ¶netici giriÅŸi (ekranda gÃ¶sterilmiyor)
    if (loginVal === "admin" && pass === "spark123") {
      currentUser = {
        id: "ADMIN",
        name: "YÃ¶netici",
        email: "admin@sparkad.studio",
        role: "admin",
      };
      localStorage.setItem("spark_current_user", JSON.stringify(currentUser));
      statusLogin.textContent = "YÃ¶netici olarak giriÅŸ yapÄ±ldÄ±.";
      updateHeaderState();
      setActiveScreen("admin");
      return;
    }

    try {
      const usersRef = collection(db, "users");
      const snap = await getDocs(usersRef);
      let found = null;
      snap.forEach(d => {
        const u = d.data();
        if ((u.email === loginVal || u.name === loginVal) && u.pass === pass) {
          found = { id: d.id, ...u };
        }
      });

      if (!found) {
        statusLogin.textContent = "KullanÄ±cÄ± bulunamadÄ± veya ÅŸifre hatalÄ±.";
        return;
      }

      const now = new Date().toLocaleString("tr-TR");
      try {
        await updateDoc(doc(db, "users", found.id), { lastLogin: now });
      } catch (e) {}
      found.lastLogin = now;

      currentUser = found;
      localStorage.setItem("spark_current_user", JSON.stringify(currentUser));
      statusLogin.textContent = "";
      updateHeaderState();

      if (currentUser.role === "admin") {
        setActiveScreen("admin");
      } else {
        welcomeText.textContent = `HoÅŸ geldin, ${currentUser.name} ğŸ‘‹`;
        renderProfile();
        loadNotificationsForUser();
        setActiveScreen("main");
      }
    } catch (err) {
      console.error(err);
      statusLogin.textContent = "Sunucuya baÄŸlanÄ±rken hata oluÅŸtu. Firestore Rules engelliyor olabilir.";
    }
  });

  function renderProfile() {
    if (!currentUser || currentUser.role !== "user") return;
    profileInfo.innerHTML = `
      Ad: <strong>${currentUser.name}</strong><br>
      E-posta: ${currentUser.email}<br>
      Ãœyelik: ${currentUser.createdAt || "-"}<br>
      Son giriÅŸ: ${currentUser.lastLogin || "-"}
    `;
  }

  async function loadNotificationsForUser() {
    if (!currentUser || currentUser.role !== "user") return;
    try {
      const reqRef = collection(db, "requests");
      const snap = await getDocs(reqRef);
      const my = [];
      snap.forEach(d => {
        const r = d.data();
        if (r.userEmail === currentUser.email) my.push(r);
      });

      if (!my.length) {
        notifList.innerHTML = `<div>HenÃ¼z reklam isteÄŸin yok. StÃ¼dyo ekranÄ±ndan yeni bir istek gÃ¶nderebilirsin.</div>`;
        return;
      }

      my.sort((a, b) => (a.createdAt || "").localeCompare(b.createdAt || ""));
      notifList.innerHTML = my.map(r => {
        let cls = "s-pending";
        let txt = "Beklemede";
        if (r.status === "approved") {
          cls = "s-approved";
          txt = "OnaylandÄ±";
        } else if (r.status === "rejected") {
          cls = "s-rejected";
          txt = "Reddedildi";
        }
        return `
          <div class="notif-item">
            <div class="notif-meta">
              ${r.createdAt || ""} â€“ <strong>${r.brand}</strong> (${r.product})
              <span class="pill-status ${cls}">${txt}</span>
            </div>
            <div>${r.details}</div>
            ${r.adminNote ? `<div style="font-size:12px; margin-top:4px;">YÃ¶netici notu: ${r.adminNote}</div>` : ""}
          </div>
        `;
      }).join("");
    } catch (err) {
      console.error(err);
      notifList.innerHTML = "<div>Bildirimler yÃ¼klenirken hata oluÅŸtu.</div>";
    }
  }

  document.getElementById("btn-send-ad").addEventListener("click", async () => {
    statusAd.textContent = "";
    if (!currentUser || currentUser.role !== "user") {
      statusAd.textContent = "Ã–nce kullanÄ±cÄ± olarak giriÅŸ yapmalÄ±sÄ±n.";
      return;
    }
    const brand = document.getElementById("ad-brand").value.trim();
    const product = document.getElementById("ad-product").value.trim();
    const desc = document.getElementById("ad-desc").value.trim();

    if (!brand || !product || !desc) {
      statusAd.textContent = "LÃ¼tfen tÃ¼m alanlarÄ± doldur.";
      return;
    }

    try {
      const now = new Date().toLocaleString("tr-TR");
      await addDoc(collection(db, "requests"), {
        userName: currentUser.name,
        userEmail: currentUser.email,
        brand,
        product,
        details: desc,
        status: "pending",
        adminNote: "",
        createdAt: now,
      });

      document.getElementById("ad-brand").value = "";
      document.getElementById("ad-product").value = "";
      document.getElementById("ad-desc").value = "";
      statusAd.textContent = "Reklam isteÄŸin YÃ¶neticiye gÃ¶nderildi.";
      loadNotificationsForUser();
    } catch (err) {
      console.error(err);
      statusAd.textContent = "Reklam isteÄŸi gÃ¶nderilirken hata oluÅŸtu.";
    }
  });

  document.getElementById("btn-send-msg").addEventListener("click", async () => {
    statusMsg.textContent = "";
    if (!currentUser || currentUser.role !== "user") {
      statusMsg.textContent = "Ã–nce kullanÄ±cÄ± olarak giriÅŸ yapmalÄ±sÄ±n.";
      return;
    }
    const subject = document.getElementById("msg-subject").value.trim();
    const body = document.getElementById("msg-body").value.trim();
    if (!subject || !body) {
      statusMsg.textContent = "Konu ve mesaj dolu olmalÄ±.";
      return;
    }
    try {
      const now = new Date().toLocaleString("tr-TR");
      await addDoc(collection(db, "messages"), {
        fromName: currentUser.name,
        fromEmail: currentUser.email,
        subject,
        body,
        createdAt: now,
      });
      document.getElementById("msg-subject").value = "";
      document.getElementById("msg-body").value = "";
      statusMsg.textContent = "MesajÄ±n YÃ¶neticiye iletildi.";
    } catch (err) {
      console.error(err);
      statusMsg.textContent = "Mesaj gÃ¶nderilirken hata oluÅŸtu.";
    }
  });

  onSnapshot(collection(db, "requests"), (snap) => {
    const list = [];
    snap.forEach(d => list.push({ id: d.id, ...d.data() }));
    renderAdminRequests(list);
  });

  onSnapshot(collection(db, "messages"), (snap) => {
    const list = [];
    snap.forEach(d => list.push({ id: d.id, ...d.data() }));
    renderAdminMessages(list);
  });

  onSnapshot(collection(db, "users"), (snap) => {
    const list = [];
    snap.forEach(d => list.push({ id: d.id, ...d.data() }));
    renderAdminUsers(list);
  });

  function renderAdminRequests(list) {
    if (!list.length) {
      adminRequestsBox.innerHTML = "<div>HenÃ¼z reklam isteÄŸi yok.</div>";
      return;
    }
    list.sort((a, b) => (a.createdAt || "").localeCompare(b.createdAt || ""));
    adminRequestsBox.innerHTML = list.map(r => {
      let cls = "s-pending";
      let txt = "Beklemede";
      if (r.status === "approved") { cls = "s-approved"; txt = "OnaylandÄ±"; }
      else if (r.status === "rejected") { cls = "s-rejected"; txt = "Reddedildi"; }
      const approvedLocked = r.status === "approved";
      return `
        <div class="admin-item">
          <div class="admin-meta">
            ${r.createdAt || ""} â€“ <strong>${r.brand}</strong> (${r.product}) |
            ${r.userName} (${r.userEmail})
            <span class="pill-status ${cls}">${txt}</span>
          </div>
          <div>${r.details}</div>
          ${r.adminNote ? `<div>YÃ¶netici notu: ${r.adminNote}</div>` : ""}
          <div class="admin-actions">
            <input type="text" id="note-${r.id}" placeholder="KÄ±sa not (opsiyonel)" />
            <button class="btn-small btn-approve" data-id="${r.id}" data-status="approved" ${approvedLocked ? "disabled" : ""}>Onayla</button>
            <button class="btn-small btn-reject" data-id="${r.id}" data-status="rejected" ${approvedLocked ? "disabled" : ""}>Reddet</button>
          </div>
          ${approvedLocked ? `<div style="font-size:11px;color:#4ade80;margin-top:3px;">Bu istek onaylandÄ±, tekrar reddedilemez.</div>` : ""}
        </div>
      `;
    }).join("");

    adminRequestsBox.querySelectorAll("button[data-id]").forEach(btn => {
      btn.addEventListener("click", async () => {
        if (!currentUser || currentUser.role !== "admin") return;
        const id = btn.dataset.id;
        const newStatus = btn.dataset.status;
        const noteInput = document.getElementById(`note-${id}`);
        const adminNote = noteInput ? noteInput.value.trim() : "";
        try {
          const ref = doc(db, "requests", id);

          const allSnap = await getDocs(collection(db, "requests"));
          let current = null;
          allSnap.forEach(d => {
            if (d.id === id) current = d.data();
          });
          if (current && current.status === "approved" && newStatus === "rejected") {
            alert("Onaylanan bir istek reddedilemez.");
            return;
          }

          await updateDoc(ref, { status: newStatus, adminNote });
        } catch (err) {
          console.error(err);
          alert("Durum gÃ¼ncellenirken hata oluÅŸtu.");
        }
      });
    });
  }

  function renderAdminMessages(list) {
    if (!list.length) {
      adminMessagesBox.innerHTML = "<div>HenÃ¼z mesaj yok.</div>";
      return;
    }
    list.sort((a, b) => (a.createdAt || "").localeCompare(b.createdAt || ""));
    adminMessagesBox.innerHTML = list.map(m => `
      <div class="admin-item">
        <div class="admin-meta">
          ${m.createdAt || ""} â€“ <strong>${m.fromName}</strong> (${m.fromEmail}) â€“ ${m.subject}
        </div>
        <div>${m.body}</div>
      </div>
    `).join("");
  }

  function renderAdminUsers(list) {
    if (!list.length) {
      adminUsersBox.innerHTML = "<div>HenÃ¼z Ã¼ye yok.</div>";
      return;
    }
    list.sort((a, b) => (a.createdAt || "").localeCompare(b.createdAt || ""));
    adminUsersBox.innerHTML = list.map(u => `
      <div class="admin-item">
        <div class="admin-meta">
          KullanÄ±cÄ±: <strong>${u.name}</strong> (${u.email})
        </div>
        <div>Ãœyelik: ${u.createdAt || "-"}</div>
        <div>Son giriÅŸ: ${u.lastLogin || "-"}</div>
      </div>
    `).join("");
  }

  (function initFromStorage() {
    const raw = localStorage.getItem("spark_current_user");
    if (raw) {
      try { currentUser = JSON.parse(raw); } catch (e) { currentUser = null; }
    }
    updateHeaderState();
    if (currentUser) {
      if (currentUser.role === "admin") {
        setActiveScreen("admin");
      } else {
        welcomeText.textContent = `HoÅŸ geldin, ${currentUser.name} ğŸ‘‹`;
        renderProfile();
        loadNotificationsForUser();
        setActiveScreen("main");
      }
    } else {
      setActiveScreen("info");
    }
  })();
</script>

</body>
</html>
